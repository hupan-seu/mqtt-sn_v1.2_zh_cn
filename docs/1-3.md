## 1. 更改和修订历史
### 1.1 版本1.0，2007年11月29日
- 初始版本

### 1.2 版本1.1，2008年6月5日
- 新功能：支持休眠设备

### 1.3 版本1.2，2011年5月20日
- 新功能：支持大于255个字节的消息长度
- 转发器封装的格式更改为Nicholas O'Leary提出的格式（nick oleary@uk.ibm.com）
- 添加了返回代码值“0x03已拒绝，不支持”
- 字段“ReturnCode”已添加到消息WILLTOPICRESP和WILLMSGRESP中

## 2. 简介
近期无线传感器网络（WSN）的热度日益增加，无论是商业还是技术，原因是它简单，低成本和易于部署。 这些网络可以用于不同的目的， 从测量和检测，到自动化和过程控制。 典型的无线传感网络由大量的电池供电的传感器和执行器（SA）组成，这些器件通常只有有限的存储和处理能力。 由于SA节点的数量通常非常大，有线基础设施的部署成本昂贵，所以这些设备的无线通信很重要 。 这样的网络本质上是非常动态的：无线链路可能随时暂时中断，节点可能会失效并经常更换。 在这种情况下，与个别节点使用地址进行通信的传统方法可能成为一场噩梦。 应用程序驻留在固定网络上，与无线SA设备的交互，需要管理和维护与大量节点设备的通信。 在大多数情况下，他们不需要知道提供信息设备的地址或身份 ，但对数据的内容更感兴趣。 例如，资产跟踪应用，更感兴趣的是某个资产的当前位置，而不是提供该资产位置信息的GPS接收器的网络地址。 此外，一些应用可能对相同的传感器数据感兴趣，但出于不同的目的。在这种情况下，SA节点将需要并行的管理和维护具有多个应用程序的通信装置。 这可能会超过简单和低成本SA设备的有限功能。  

另一个问题是网络之间的寻址方案的差异。 例如，基于TCP/IP的网络上的应用程序，如何寻址基于ZigBee无线网络的SA设备？  

可以通过使用以消息为中心的通信方法来克服上述问题，其中信息发送给接收方，不是基于它们的网络地址，而是基于信息内容的功能和它们的兴趣。  一个广为所知的消息为中心系统是“发布、订阅”消息系统，已经在企业网络中广泛使用了，主要是由于它们的可扩展性和支持动态网络拓扑。 将企业发布/订阅系统扩展到无线传感网络，也可以实现无线传感网络无缝集成到企业网络中，从而使SA收集的数据，可提供给任何其他企业应用，并允许从任何企业应用中控制SA。 这可以通过使用MQTT协议来实现，该协议是开放的轻量级发布/订阅协议，专为机器对机器和移动应用场景而设计。 它针对带宽成本非常高的网络和通信不可靠的网络专门做了优化。 但是，MQTT需要基于底层网络，例如TCP/IP，提供有序的可靠连接，但这种网络对于非常简单、占用空间小、成本低的无线SA等设备来说还是太复杂了。   

本文档的目的是详细描述MQTT-SN协议，一种用于无线传感器网络的发布/订阅协议。 MQTT-SN可以被视为MQTT的一个版本，它适应无线通信环境的特性。因为容易衰落和受到干扰，无线射频链路通常具有比有线链路更高的错误率。 它们的传输速率也较低。 例如， 基于IEEE 802.15.4标准的无线传感网络在2.4GHz频带中提供250kbit/s的最大带宽。 而且，为了抵抗传输错误，它们的分包长度非常短。 在IEEE的802.15.4定义中，物理层的数据包长度限制为128字节。 这128个字节中的一半还会被必要的网络传输信息占据， 比如MAC层，网络层，安全等。   

MQTT-SN还针对具有有限处理能力和存储资源的低成本电池供电设备进行了优化 。  

MQTT-SN最初开发用于在ZigBee APS层之上运行 。 ZigBee是开放工业联盟旨在为无线传感器网络定义一个开放的全球通信标准。为了全球化，ZigBee选择IEEE标准802.15.4作为PHY层和MAC层的协议，在此标准上增加了所需的网络，安全层和应用层，从而提供了不同厂商的产品之间的互操作性 。  

MQTT-SN的设计使其无法与底层网络服务相关联。任何在某一节点和特定节点（网关）之间提供双向数据传输服务的网络能够支持MQTT-SN。 例如，一个允许源端点发送数据到特定目标端点的简单数据报服务就足够了。 广播数据传输服务仅在网关发现过程中需要。为了减少网关发现过程中的广播流量，期望MQTT-SN可以将所需的广播半径指示给底层网络。  

## 3. MQTT-SN 与 MQTT 比较

MQTT-SN设计为尽可能接近MQTT，但适应无线通信环境的特性，如低带宽，高链路故障，短消息长度等。它也为有限处理和存储资源的低成本，电池供电设备的实现进行了优化。  

与MQTT相比，MQTT-SN具有以下不同之处：  

1. CONNECT消息分为三条消息。 另外两个是可选的，用于将遗嘱主题和遗嘱消息传送到服务器。  
2. 为了应对无线网络中的短消息长度和有限的传输带宽，PUBLISH消息中的主题名称由短的、两字节长的“主题ID”替换。 注册过程定义为允许客户端向服务器/网关注册主题名称并获取相应的主题ID。 它也用于相反的方向，以通知客户端主题名称和相对应的，将包含在接下来PUBLISH消息中的主题ID。   
3. 引入了“预定义”主题ID和“短”主题名称，无需注册。 预定义的主题ID也是主题名称的两个字节的替换，它们映射到的主题名称，是客户端的应用程序和网关/服务器都预先知道的。 因此双方都可以使用预定义的主题ID，在“，不需要像正常”主题ID那样，上文提到的注册。短主题名称是刚刚好两字节的主体名称，它们足够短以至于可以和数据一起在PUBLISH消息中发送，和预定义主体id一样，短主题名称也不需要注册。  
4. 发现过程可帮助没有预先配置的服务器/网关地址的客户端，发现运行着的服务器/网关的真实网络地址。 多个网关可以同时存在于单个无线网络中，可以工作在负载均衡模式或主从模式下协同工作。   
5. “清除会话”的语义扩展到了遗嘱功能，即不仅仅是客户端的订阅是持久性，遗嘱主题和遗嘱消息也是。 客户端还可以在会话期间，修改遗嘱l主题和遗嘱消息。   
6. 定义了一个新的离线保持活动过程，用来支持休眠的客户端。 通过这个程序， 电池供电的设备可以进入休眠状态，在该状态期间，所有发往它们的消息都被缓冲在服务器/网关处，并在他们醒来后发送给它们。  

