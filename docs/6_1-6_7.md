## 6. 功能描述
MQTT-SN的一个重要设计点是尽可能接近MQTT。因此，所有协议语义
应尽可能保持与MQTT定义的相同。  
在下文中，我们将重点关注那些相对于MQTT新增或修改的点。  

### 6.1 网关的广播和发现  
此过程是全新的，在MQTT中不存在。  

网关可以通过周期性地向所有连到网络中的设备，广播ADVERTISE消息来宣告其存在。网关应该仅通告它自己的存在（如果网关连接到服务器，或者它本身就是一个服务器）。  

多个网关可以在同一网络中同时处于活动状态。在这种情况下，他们会有不同的id，由客户端决定它想要连接哪个网关。但是在任何时候客户端都只允许连接到一个网关。  

客户端应维护活动的网关列表及其网络地址。这个列表通过收到的ADVERTISE消息和GWINFO消息填充和更新。  

在持续时间 中指示直到网关发送下一个ADVERTISE消息的持续时间T ADV
ADVERTISE消息的字段。客户端可以使用此信息来监视网关的可用性。
例如，如果它没有接收到来自Ñ个网关ADVERTISE消息 ADV连续次数，也可能
假设网关已关闭并将其从活动网关列表中删除。同样，网关处于备用状态
如果连续几次错过，模式将变为活动状态（即开始发送ADVERTISE消息）
来自某个网​​关的广告。
由于ADVERTISE消息被广播到整个无线网络中，因此时间间隔为T ADV
在网关发送的两个ADVERTISE消息之间应该足够大（例如大于15分钟）以避免
网络中的带宽拥塞。
T ADV 的大值将导致寻找网关的新客户等待很长时间。
为了缩短该等待时间，客户端可以广播SEARCHGW消息。防止广播风暴时
几个客户端几乎同时开始搜索GW，发送SEARCHGW消息是
延迟了0到T SEARCHGW 之间的随机时间。客户将取消其SEARCHGW的传输
如果它在此延迟时间内收到另一个客户端发送的SEARCHGW消息，并且该消息与该消息相同
它想要发送的一个，并且表现得好像SEARCHGW消息是自己发送的。
SEARCHGW消息的广播半径R b是有限的，例如在密集的情况下是单跳
部署MQTT-SN客户端。
收到SEARCHGW消息后，网关将回复包含其的GWINFO消息ID。西米
同样，如果客户端在其活动网关列表中至少有一个活动网关，则会使用GWINFO消息进行应答。
如果客户端在其列表中具有多个GW，则从其列表中选择一个GW并将该信息包括在其中
GWINFO消息。
与SEARCHGW消息一样，GWINFO消息以相同的半径R b 广播，这是半径
在SEARCHGW消息中输入。 当这两个消息时，半径R b也被赋予底层
传递下去传播。
为了优先考虑网关，客户端将延迟发送GWINFO消息一段随机时间
T GWINFO。如果在此延迟时间内客户端收到GWINFO消息，它将取消其传输
GWINFO消息。
在没有响应的情况下，可以重传SEARCHGW消息。在这种情况下的时间间隔
应该以指数方式增加两个连续的SEARCHGW消息。

### 6.2 客户端的连接设置 
