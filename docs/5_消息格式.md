
## 5. 消息格式

### 5.1 基本消息格式

消息头 | 消息可变部分
---|--- 
2或4字节 | n字节
表1：基本消息格式

MQTT-SN消息的基本格式如表1所示。MQTT-SN消息由两部分组成： 一个2或4个字节长的头和一个可选的可变部分。 消息头始终存在并包含确定的字段，可变部分的存在和内容取决于消息的类型。  

### 5.2 消息头
消息头的格式如表2所示。  

长度 | 消息类型
---|--- 
1或3字节 | 1字节
表2：消息头

#### 5.2.1 长度
“长度”字段为1或3字节，指明消息中包含的字节总数（包括长度字段本身）。  
如果长度字段的第一个字节编码为“0x01”，则长度字段长度为3个字节。在这种情况下，接下来的两个字节指定消息的字节总数（高位在前）。 否则，长度字段只有1个字节，并指定包括自己在内的消息字节总数。   
3字节格式允许编码最长65535字节的消息。 小于256个字节的消息可以使用1字节格式。   
请注意，由于MQTT-SN不支持消息分段和重组，所以可以在网络中使用的最大消息长度，实际由该网络支持的最大数据包长度决定， 而不是由MQTT-SN编码的最大长度决定。  

#### 5.2.2 消息类型
“消息类型”字段长度为1个字节，并指定消息类型。 它应设置为表3中的一个值。

字段值 | 消息类型 | 字段值 | 消息类型 
---| --- | --- | ---
0x00 | ADVERTISE | 0x01 | SEARCHGW
0x02 | GWINFO | 0x03 | 保留 
0x04 | CONNECT | 0x05 | CONNACK
0x06 | WILLTOPICREQ | 0x07 | WILLTOPIC
0x08 | WILLMSGREQ | 0x09 | WILLMSG
0x0A | REGISTER |  0x0B | REGACK
0x0C | PUBLISH |  0x0D | PUBACK
0x0E | PUBCOMP |  0x0F | PUBREC
0x10 | PUBREL |  0x11 | 保留 
0x12 | SUBSCRIBE |  0x13 | SUBACK
0x14 | UNSUBSCRIBE |  0x15 | UNSUBACK
0x16 | PINGREQ | 0x17 | PINGRESP
0x18 | DISCONNECT |  0x19 | 保留 
0x1A | WILLTOPICUPD |  0x1B | WILLTOPICRESP
0x1C | WILLMSGUPD |  0x1D | WILLMSGRESP
0x1E-0xFD | 保留 |  0xFE | 概括的消息？
0xFF | 保留 |

### 5.3 消息可变部分
消息变量部分的内容取决于消息的类型。 以下字段是消息可变部分中的内容。
#### 5.3.1 